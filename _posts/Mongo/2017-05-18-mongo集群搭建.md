---
layout: life
title: mongo集群搭建
category: Mongo
date: 2017-05-18
---

******

	作者: minus
	版本: V 0.0.1
	日期: 2017年05月18日
	mail: minus@stu.xjtu.edu.cn

<!-- more -->

*******

### Mongo集群架构
1. mongo基本情况及集群服务器情况
```
该mongo集群服务器一共使用8台服务器，其中6台服务器用来部署搭建shard /  config / arbiter 服务器，剩下两台服务器用来搭建mongos，以供外部应用连接
本集群使用的是mongo最新版本3.4, 其具有更强大的功能
```

2. 集群部署图
![mongo集群](/res/img/blog/mongo/mongo-cluster.png)

### 配置文件具体情况
0. 配置说明
```
根据上面集群示意图可以看出，一共有6台机器作为shard服务器（6个shard配置文件）, 3台机器作为arbiter服务器（3个arbiter配置文件），3台机器作为configure服务器（3个config配置文件），以下分别列出三类配置文件中一个具体的配置情况，其他机器上的配置文件需要 注释修改（如路径、服务器名、复制集名）
```

1. mongo-shard服务器的配置文件内容[server-mongo1]
```
# for documentation of all options, see:
#   http://docs.mongodb.org/manual/reference/shard1uration-options/
# Where and how to store data.
```
```
storage:
   dbPath: /mongo-db/shard11/data                   // 路径修改
   journal:
      enabled: true
   engine: wiredTiger
```
```   
systemLog:
  destination: file
  logAppend: false
  path: /mongo-db/shard11/log/mongod.log            // 路径修改
```
```  
processManagement:
  fork: true
  pidFilePath: /mongo-db/shard11/mongod.pid         // 路径修改
```
```  
net:
  port: 30000
  bindIp: mongo1                                    // 服务器名修改
```
```  
security:
  keyFile: /mongo-db/mongokey
```
```  
sharding:
  clusterRole: shardsvr
```
```  
replication:
  replSetName: replset1                             // 复制集名称修改
```
```  
setParameter:
  cursorTimeoutMillis: 12000000                     // 默认参数6000000
```

2. mongo-arbiter服务器的配置文件内容[server-mongo1]
```
# for documentation of all options, see:
#   http://docs.mongodb.org/manual/reference/shard1uration-options/
# Where and how to store data.
```
```
storage:
   dbPath: /mongo-db/arbiter2/data                   // 路径修改
   journal:
      enabled: true
   engine: wiredTiger
```
```
systemLog:
  destination: file
  logAppend: false
  path: /mongo-db/arbiter2/log/mongod.log            // 路径修改
```
```
processManagement:
  fork: true
  pidFilePath: /mongo-db/arbiter2/mongod.pid         // 路径修改
```
```
net:
  port: 30002
  bindIp: mongo1                                      // 服务器名修改
```
```
security:
  keyFile: /mongo-db/mongokey
```
```
sharding:
  clusterRole: shardsvr
```
```
replication:
  replSetName: replset2                               // 复制集名修改
```
```
setParameter:
  cursorTimeoutMillis: 12000000                       // 默认参数6000000
```

3. mongo-config服务器的配置文件内容
```sh
# for documentation of all options, see:
#   http://docs.mongodb.org/manual/reference/shard1uration-options/
# Where and how to store data.
```
```
storage:
   dbPath: /mongo-db/config1/data                     // 路径修改
   journal:
      enabled: true
   engine: wiredTiger
```
```   
systemLog:
  destination: file
  logAppend: false
  path: /mongo-db/config1/log/mongod.log             // 路径修改
```
```  
processManagement:
  fork: true
  pidFilePath: /mongo-db/config1/mongod.pid          // 路径修改
```
```  
net:
  port: 30001
  bindIp: mongo2                                     // 服务器名修改
```
```  
security:
  keyFile: /mongo-db/mongokey
```
```  
sharding:
  clusterRole: configsvr
```
```  
replication:
  replSetName: configreplset                        // 复制集名修改
```
```  
setParameter:
  cursorTimeoutMillis: 12000000                     // 默认参数6000000
```

4. mongo-mongos服务器的配置文件内容
```sh
# for documentation of all options, see:
#   http://docs.mongodb.org/manual/reference/shard1uration-options/
```
```
systemLog:
  destination: file
  logAppend: false
  path: /mongo-db/mongos/log/mongo.log
```
```
processManagement:
  fork: true
  pidFilePath: /mongo-db/mongos/mongo.pid
```
```
net:
  port: 30003
#  bindIp: mongos1                                                // 修改服务器名
```
```
sharding:
  configDB: configreplset/mongo2:30001,mongo4:30001,mongo6:30001
```
```
security:
  keyFile: /mongo-db/mongokey
```
```
setParameter:
  cursorTimeoutMillis: 12000000                                   // 默认参数6000000
```

5. [所有配置文件](/res/download/mongo_conf/mongo-db.tar)
